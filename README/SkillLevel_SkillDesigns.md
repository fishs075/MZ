## SKM_SkillLevel.js 対応: レベル連動スキル案 10

前提プラグイン: `SKM_SkillLevel.js` / `SkillTree.js`

使う主な仕組み:
- ダメージ式で `a.slv` / `a.sxp` を参照
- スキルのメモ欄タグでパラメータ補正
  - 速度補正: `<skm_slv_SPD: 式>`
  - MP消費: `<skm_slv_MPC: 式>`
  - TP消費: `<skm_slv_TPC: 式>`
  - 命中率: `<skm_slv_HIT: 式>`
  - 会心率: `<skm_slv_CRT: 式>`
- 使用効果の有効/無効条件: `<条件効果_X: 条件式>`
  - 使用可能記法例: `1 < slv`, `2 =< slv`, `slv === 10` など
  - `>` は使用不可、`=` は `===` を使用
- 他スキルとの連動: `slv[id]`, `sxp[id]` を式に利用

ダメージ伸びの基本係数例（プラグイン解説準拠）:
```
((10 + (a.slv - 1) + 3 * Math.floor(a.slv / 5)) / 10)
```

---

### 1) 紅蓮斬（単体/物理/火） 想定ID: 201
- コンセプト: レベル到達で追加効果が段階開放される高火力近接
- レベル別変化:
  - Lv1: 基本ダメージ
  - Lv3: 追加効果「火傷」付与（効果2）
  - Lv5: 防御貫通気味（ダメージ式で `b.def` 係数軽減）
  - Lv7: TP消費軽減
  - Lv10: 追撃相当の追加ダメージ（計算式で加算）
- ダメージ計算式例:
```
// 例: 通常物理ベースをslvで伸長 + Lv5以降やや貫通
const s = a.slv;
const base = (a.atk * 4 - b.def * (s >= 5 ? 1.5 : 2)) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
base + a.sxp * a.atk
```
- メモ欄例:
```
<skm_slv_TPC: -(Math.floor((slv - 1) / 2))>
<条件効果_2: 3 =< slv>   // 効果2: 火傷付与
<a.sxp: (slv === 10 ? 1.2 : 0)> // Lv10で固定加算倍率をa.sxpに格納
```

---

### 2) 氷鎖束縛（単体/魔法/氷） 想定ID: 202
- コンセプト: 行動阻害系の成長。速度デバフや凍結段階
- レベル別変化:
  - Lv1: 氷ダメージ（命中安定）
  - Lv2: 束縛系ステート付与（効果2）
  - Lv5: 付与率強化（効果3を追加）
  - Lv7: ダメージ式に小幅加算（効果は使用しない）
  - Lv10: 凍結（上位ステートに差し替え/効果5）
- 命中/行動順補正例:
```
<skm_slv_HIT: 5 + Math.floor(slv / 2)>
<skm_slv_SPD: Math.floor(slv / 2)>
<条件効果_2: 2 =< slv>
<条件効果_3: 5 =< slv>
<条件効果_5: slv === 10>
```
- 追加メモ欄例（a.sxp算出）:
```
<a.sxp: (slv >= 7 ? 0.8 : 0)>
```
- ダメージ式例:
```
const s = a.slv;
const base = (a.mat * 4 - b.mdf * 2) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
base + a.sxp * a.mat
```

---

### 3) 雷鳴穿（単体/魔法/雷） 想定ID: 203
- コンセプト: クリティカル/追撃寄りの瞬間火力
- レベル別変化:
  - Lv1: 雷属性ダメージ
  - Lv4: 麻痺付与（効果2）
  - Lv6: 会心率上昇
  - Lv8: 50%で追加加算（計算式で判定）
  - Lv10: 基礎威力ボーナス
- メモ欄例:
```
<skm_slv_CRT: 2 * Math.floor(slv / 2)>
<条件効果_2: 4 =< slv>
```
- 追加メモ欄例（a.sxp算出: 50%追加を期待値0.5Hitに変換）:
```
<a.sxp: (slv >= 8 ? 0.5 : 0)>
```
- ダメージ式例:
```
const s = a.slv;
const base = (a.mat * 5 - b.mdf * 2) * ((11 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
base * (1 + a.sxp)
```

---

### 4) 聖光癒陣（単体/回復/聖） 想定ID: 204
- コンセプト: 回復量↑ + 状態異常解除が段階解放
- レベル別変化:
  - Lv1: 単体回復
  - Lv3: 弱体/毒系1つ解除（効果2）
  - Lv5: 解除対象拡張（効果3）
  - Lv7: MP消費軽減
  - Lv10: 回復量に固定加算ボーナス
- メモ欄例:
```
<skm_slv_MPC: -(1 + Math.floor(slv / 3))>
<条件効果_2: 3 =< slv>
<条件効果_3: 5 =< slv>
```
- 回復式例（回復スキルの数式欄）:
```
const s = a.slv;
((a.mat * 4) + 20 * Math.floor(s / 5)) * ((10 + (s - 1)) / 10)
```

---

### 5) 影分身（自己強化/補助） 想定ID: 205
- コンセプト: 回避・反撃をレベルで開放、先制しやすい
- レベル別変化:
  - Lv1: 回避上昇ステート付与（効果1）
  - Lv5: 反撃上昇ステート追加（効果2）
  - Lv7: 追加持続（効果3: 別IDの短持続ステートを重ねる）
  - Lv10: 次の攻撃ダメージ強化ステート（効果4）
- メモ欄例:
```
<skm_slv_SPD: 2 * slv>
<条件効果_2: 5 =< slv>
<条件効果_3: 7 =< slv>
<条件効果_4: slv === 10>
```

---

### 6) 大地震脚（全体/物理/土） 想定ID: 206
- コンセプト: 広域だが命中が伸びるほど安定、転倒付与
- レベル別変化:
  - Lv1: 全体物理
  - Lv3: 転倒ステート付与（効果2）
  - Lv6: 命中上昇
  - Lv8: 速度補正上昇（行動早め）
  - Lv10: 基礎威力UP
- メモ欄例:
```
<skm_slv_HIT: 5 + slv>
<skm_slv_SPD: Math.floor(slv / 2)>
<条件効果_2: 3 =< slv>
```
- ダメージ式例:
```
const s = a.slv;
(a.atk * 3 - b.def * 1.8) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10)
```

---

### 7) 毒刃連奏（単体/物理/毒） 想定ID: 207
- コンセプト: レベルで毒強化 + 使用で別スキルの熟練度が上がる
- レベル別変化:
  - Lv1: 小ダメージ + 毒（効果2）
  - Lv4: 追毒（効果3）
  - Lv7: TP消費軽減
  - Lv10: ダメージ倍率ボーナス
- メモ欄例:
```
<skm_slv_TPC: -(Math.floor(slv / 3))>
<skm_sxp_gain_id: 220>      // 例: 「毒術」(ID:220) の熟練度が上がる
<条件効果_2: 1 < slv>
<条件効果_3: 4 =< slv>
```
- ダメージ式例:
```
const s = a.slv;
(a.atk * 3.2 - b.def * 1.4) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10)
```

---

### 8) 風刃連舞（単体/物理/風・多段相当） 想定ID: 208
- コンセプト: レベルで“ヒット数相当”が増える（計算式で係数化）
- レベル別変化:
  - Lv1: 1Hit相当（係数=1）
  - Lv3: 2Hit相当（係数=2）
  - Lv5: 3Hit相当（係数=3）
  - Lv8: 命中上昇
  - Lv10: 会心上昇
- メモ欄例:
```
<skm_slv_HIT: 3 + Math.floor(slv / 2)>
<skm_slv_CRT: Math.floor(slv / 2)>
```
- 追加メモ欄例（a.sxp算出: 追加Hit数を格納）:
```
<a.sxp: (slv >= 5 ? 2 : (slv >= 3 ? 1 : 0))>
```
- ダメージ式例（係数で多段相当を合成）:
```
const s = a.slv;
const oneHit = (a.atk * 2.2 - b.def * 1.2) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
oneHit * (1 + a.sxp)
```

---

### 9) 魔力循環（自己強化/持続MP効率） 想定ID: 209
- コンセプト: MP消費軽減と行動加速、レベルで効率向上
- レベル別変化:
  - Lv1: MP消費-1
  - Lv4: MP消費-2
  - Lv6: 速度補正上昇
  - Lv8: 命中微増
  - Lv10: 次に使用する魔法の威力+（効果2: 一時バフ用ステート）
- メモ欄例:
```
<skm_slv_MPC: -(1 + Math.floor(slv / 3))>
<skm_slv_SPD: Math.floor(slv / 2)>
<skm_slv_HIT: Math.floor(slv / 3)>
<条件効果_2: slv === 10>
```

---

### 10) 剣マスタリー（パッシブ/武器適性） 想定ID: 210
- コンセプト: 剣装備時に通常攻撃・剣技が伸びる基礎適性（未習得でも弱体化しない）
- 実装方針: ダメージ式側は `a.slv` / `a.sxp` のみ参照。装備判定とマスタリーレベルはノートで `a.sxp` に反映。
  - 対象スキル（通常攻撃や剣スキル）のメモ欄例:
```
<a.sxp: (data.isWtypeEquipped(2) ? slv[210] : 0)>
```
  - ダメージ式例（DB側）:
```
(a.atk * 4 - b.def * 2) * (1 + 0.05 * a.sxp)
```
  - 未習得時は `a.sxp=0` のため基礎威力を維持。必要に応じて `a.slv` は従来どおりそのスキル固有のLv伸びに利用。

---


#### 運用補足: 職業別の攻撃スキル分離
 職業の特徴で攻撃＞攻撃スキルを各職業ごとに別々にしておくと001:攻撃に膨大な式を書かなくてよい

- メリット
  - 001:攻撃の式が肥大化せず、調整対象を「職業別攻撃スキル」に分割できる
  - `a.slv`/`a.sxp` の役割分担（Lv伸び/追加係数）をスキル単位で完結できる
  - マスタリー等の条件（武器種・職業特性）をメモ欄で閉じ込められる
- 実装案
  1. 職業ごとに基礎攻撃スキルを用意（例: 1001:攻撃[戦士], 1002:攻撃[魔導士] ...）
  2. MZのデフォルデフォル機能（職業の特徴: 攻撃＞攻撃スキル）で、攻撃コマンドを各職業用スキルへ差し替え
  3. 各職業用攻撃スキルのメモ欄に、装備やマスタリー反映を事前計算
  
  例: 戦士の攻撃（剣マスタリーID:210を反映、未習得でも弱体化しない）
  ```
  <a.slv: 1 + slv>                         // 基準1を保証（未習得で弱体化しない）
  <a.sxp: (data.isWtypeEquipped(2) ? slv[210] : 0)>  // 剣装備時のみマスタリーレベルを反映
  ```
  ダメージ式（DB）
  ```
  (a.atk * 4 - b.def * 2) * (1 + 0.05 * a.sxp)
  ```
  - 係数や基礎式は職業ごとに変更可。`a.slv` はその職業攻撃のLv伸び、`a.sxp` は追加係数として利用。
 
 
 
 
 ## 補助スキル設計（攻撃能力なしで攻撃スキルを強化）
 
 攻撃せずに味方や自身の攻撃スキルを強化する設計です。DBのダメージ式は a.slv / a.sxp のみ参照とし、ノートで事前計算します。
 
 共通ルール
 - 強化対象（攻撃スキル）のノートに `<a.slv: ...>`, `<a.sxp: ...>` を記述し、支援スキルの `slv[id]`/`sxp[id]` やステート・装備条件を参照して係数化する。
 - 乱数や条件式はノート側で評価し、最終的に a.slv / a.sxp に畳み込む（基本は期待値化）。
 - 効果として使えるのは「HP/MP/TP 回復（±）」「ステート付与/解除」「パラメータ強化/弱体（最大2段階）」なので、支援スキル自体はこれらを付与する形にし、攻撃強化は“式側”で行う。
 
 ### A) 集中（支援）→ 任意攻撃の威力係数UP
 - 支援スキルID: 301「集中」：自己に集中ステート[51]を付与（効果）。
 - 強化対象の攻撃スキル（ノート）
 ```
 <a.sxp: (data.isStateAffected(51) ? (1 + Math.floor(slv[301] / 3)) : 0)>
 ```
 - ダメージ式（攻撃スキル側）
 ```
 const s = a.slv;
 const base = (a.atk * 4 - b.def * 2) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
 base * (1 + 0.05 * a.sxp)
 ```
 - 説明: 集中Lvが3上がるごとに+5%。ステートが切れていると0。
 
 ### B) 精密（支援）→ 命中率/会心率UP
 - 支援スキルID: 302「精密」：自己バフ（効果）。
 - 強化対象の攻撃スキル（ノート）
 ```
 <skm_slv_HIT: Math.floor(slv[302] / 2)>
 <skm_slv_CRT: Math.floor(slv[302] / 2)>
 ```
 - 説明: 支援スキルLvに応じて命中・会心が伸びる。DBのダメージ式は変更不要。
 
 ### C) 節約術（支援）→ MP/TP消費軽減
 - 支援スキルID: 303「節約術」：自己バフ（効果）。
 - 強化対象の攻撃スキル（ノート）
 ```
 <skm_slv_MPC: -Math.floor(slv[303] / 2)>
 <skm_slv_TPC: -Math.floor(slv[303] / 2)>
 ```
 - 説明: Lv2毎に消費-1。最低消費はスキル設定に依存。
 
 ### D) 断ち切る理（支援）→ 追加効果の段階解放
 - 支援スキルID: 304「断ち切る理」：自己バフ（効果）。
 - 強化対象の攻撃スキル（ノート）
 ```
 <条件効果_2: 3 =< slv[304]>  // 効果2: 軽いデバフ
 <条件効果_3: 6 =< slv[304]>  // 効果3: 上位デバフ
 ```
 - 説明: 効果のOn/Offを支援スキルLvで制御。
 
 ### E) 溜め（支援）→ 期待値で“追加Hit相当”
 - 支援スキルID: 305「溜め」：自己に“溜め”状態や熟練度を付与（効果、例: `<skm_sxp_gain: 1>`）。
 - 強化対象の攻撃スキル（ノート）
 ```
 <a.sxp: (slv[305] >= 1 ? Math.min(2, Math.floor(sxp[305] / 5)) : 0)>
 ```
 - ダメージ式（攻撃スキル側）
 ```
 const s = a.slv;
 const one = (a.atk * 2.2 - b.def * 1.2) * ((10 + (s - 1) + 3 * Math.floor(s / 5)) / 10);
 one * (1 + a.sxp)
 ```
 - 説明: 熟練度5ごとに+1Hit相当、最大+2Hit。未習得時は0（参照時は0）。
 
 ### F) 武器術（支援）→ 武器適性の合成
 - 支援スキルID: 306「槍術」：パッシブ想定。
 - 強化対象の攻撃スキル（ノート）
 ```
 <a.slv: 1 + slv + ((data.isWtypeEquipped(3)) ? slv[306] : 0)>
 ```
 - ダメージ式（攻撃スキル側）
 ```
 const s = a.slv;
 const base = (a.atk * 4 - b.def * 2);
 base * ((10 + (s - 1)) / 10)
 ```
 - 説明: 槍装備時のみスキルLvに加算（最小1を保証）。
 
 運用注意
 - `slv[id]`/`sxp[id]` は未習得時0（熟練度は内部蓄積されても参照値は0）。必要に応じて `<a.slv: 1 + ...>` で基準値を保証。
 - 乱数ベースは可能な限り期待値に畳み込み、安定した手触りにする。
 
 
 補足:
- `<条件効果_X: ...>` における比較演算子は `>` が使えないため、閾値表現は `=<`（以上）や `<`（より大きいに相当）を用いて記述してください。
- 付与率の段階強化は、同一効果を複数用意し段階ごとに有効化することで近似できます。
- 多段相当はダメージ計算式で係数化して表現します（効果は使用しない）。


